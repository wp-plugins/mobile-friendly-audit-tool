window.MobileFriendlyAudit={},function(a){var b=window.MobileFriendlyAudit;b.VERSION=1.0,b.Dom={Widget:null,Form:null,Url:null,ApiKey:null,Error:null},b.API_KEY="",b.API_URL="https://www.googleapis.com/pagespeedonline/v2/runPagespeed?",b.CHART_API_URL="http://chart.apis.google.com/chart?",b.cache_enabled=!0,b.CACHE_KEY="mobile_friendly_audit_cache",b.DEBUG=!0,b.fail_score=40,b.warning_score=70,b.warning_impact=50,b.pass_impact=0,b.onFormSubmit=function(a){a.preventDefault();var c=b.Dom.Url.val();return b.validateUrl(c)?b.runAudit(c):b.doError("Please enter a correct website URL to run the audit on."),!1},b.doError=function(a){a&&a.length?b.Dom.Error.html(a).removeClass("hidden"):b.Dom.Error.html("").addClass("hidden")},b.validateUrl=function(a){return a&&a.length>0},b.runAudit=function(c){if(b.log("New audit requested for: "+c),this.cache_enabled){var d=this.checkCache(c);if(d)return b.log("Cached request found."),this.processAuditResults(c,d),!1;b.log("Cached request not found.")}else b.log("Cached disabled.");var e=this.API_URL+"key="+this.API_KEY+"&strategy=mobile&url="+c+"&screenshot=true";this.Dom.Loader.removeClass("hidden"),this.Dom.Form.addClass("hidden"),this.Dom.Results.addClass("hidden");var f=a.ajax({url:e,dataType:"JSONP",context:this});f.done(function(a){return a.error&&a.error.message.length?(b.doError(a.error.message),!1):200!=a.responseCode?(b.doError("The requested URL did not respond with a success status. The site may be down. Please try again later."),!1):(b.cacheResponse(c,a),void b.processAuditResults(c,a))}),f.always(function(){b.Dom.Loader.addClass("hidden"),b.Dom.Form.removeClass("hidden")})},b.processAuditResults=function(c,d){b.log("Processing "+c),b.log(d);try{var e=a('[data-mfa-results-section="overall"]',this.Dom.Results);e.length>0&&b.processResult_Overall(e,c,d),e=a('[data-mfa-results-section="recommendations"]',this.Dom.Results),e.length>0&&b.processResult_Recommendations(e,c,d),e=a('[data-mfa-results-section="statistics"]',this.Dom.Results),e.length>0&&b.processResult_Statistics(e,c,d),e=a('[data-mfa-results-section="resources"]',this.Dom.Results),e.length>0&&b.processResult_Resources(e,c,d),e=a('[data-mfa-results-section="preview"]',this.Dom.Results),e.length>0&&b.processResult_Preview(e,c,d),this.Dom.Results.removeClass("hidden")}catch(f){this.doError("An error occurred displaying the results, please refresh the page and try again."),console.log(f)}return this},b.processResult_Resources=function(c,d,e){if(c&&c.length>0){for(var f=a('[data-mfa-results-section="resources"] [data-mfa-template="chart"]',b.Dom.Results),g=[{label:"JavaScript",field:"javascriptResponseBytes",colour:"e2192c"},{label:"Images",field:"imageResponseBytes",colour:"f3ed4a"},{label:"CSS",field:"cssResponseBytes",colour:"ff7008"},{label:"HTML",field:"htmlResponseBytes",colour:"43c121"},{label:"Flash",field:"flashResponseBytes",colour:"f8ce44"},{label:"Text",field:"textResponseBytes",colour:"ad6bc5"},{label:"Other",field:"otherResponseBytes",colour:"1051e8"}],h=e.pageStats,i=[],j=[],k=[],l=0,m=0,n=0,o=g.length;o>n;++n){var p=g[n].label,q=g[n].field,r=g[n].colour;if(q in h){var s=Number(h[q]);l+=s,s>m&&(m=s),i.push(p),j.push(s),k.push(r)}}f.html(this.createGooglePieChart(k,j,i,m))}return this},b.processResult_Preview=function(c,d,e){if(c&&c.length>0){var f=a('[data-mfa-results-section="preview"] [data-mfa-template="preview_image"]',b.Dom.Results),g=e.screenshot,h=g.data.replace(/_/g,"/").replace(/-/g,"+"),i=a("<img/>",{src:"data:"+g.mime_type+";base64,"+h,width:g.width});f.html(i)}return this},b.processResult_Statistics=function(c,d,e){var f=function(c,d){var e=a('[data-mfa-results-section="statistics"] table [data-mfa-template="'+c+'"]',b.Dom.Results);e.length>0&&a("> td",e).html(d)};if(c&&c.length>0){var g={response_size_css:"cssResponseBytes",response_size_html:"htmlResponseBytes",response_size_image:"imageResponseBytes",response_size_js:"javascriptResponseBytes",resources_css:"numberCssResources",hosts:"numberHosts",resources_js:"numberJsResources",resources:"numberResources",resources_static:"numberStaticResources",response_size_other:"otherResponseBytes",response_size_text:"textResponseBytes",request_size_total:"totalRequestBytes"},h=e.pageStats,i=0;a.each(g,function(a,b){var c=h[b];if(a.indexOf("_size_")>=0){c=c||0;var d=parseInt(parseInt(c)/1024);i+=d,c=d+" kB"}f(a,c)}),f("response_size_total",i+" kB")}return this},b.processResult_Recommendations=function(c,d,e){var f=function(c,d,e){var f=a('[data-mfa-results-section="recommendations"] table [data-mfa-template="'+c+'"]',b.Dom.Results);f.length>0&&(a("i.fa",f).addClass(e.icon),f.addClass(e.state),d?a("> td",f).removeClass("invisible"):a("> td",f).addClass("invisible"))},g=function(a){var c=null,d=null;switch(!0){case a<=b.pass_impact:c="pass",d="fa-check";break;case a<b.warning_impact:c="warning",d="fa-question";break;default:c="fail",d="fa-times"}return{state:c,icon:d}};if(c&&c.length>0){var h={landing_page_redirects:"AvoidLandingPageRedirects",plugins:"AvoidPlugins",viewport:"ConfigureViewport",compression:"EnableGzipCompression",caching:"LeverageBrowserCaching",server_response_time:"MainResourceServerResponseTime",minify_css:"MinifyCss",minify_js:"MinifyHTML",minify_html:"MinifyJavaScript",blocking_resources:"MinimizeRenderBlockingResources",images:"OptimizeImages",visible_content:"PrioritizeVisibleContent",viewport_sizing:"SizeContentToViewport",tap_target_size:"SizeTapTargetsAppropriately",font_size:"UseLegibleFontSizes"},i=e.formattedResults.ruleResults;a.each(h,function(a,b){var c=i[b],d=g(c.ruleImpact),e="pass"!=d.state;f(a,e,d)})}return this},b.processResult_Overall=function(c,d,e){var f=function(b,c){var d=a('[data-mfa-template="score"]',c);d.length>0&&d.html(b+"/100")};if(c&&c.length>0){var g={speed:{success:a('[data-mfa-template="overall_speed_success"]',c),warning:a('[data-mfa-template="overall_speed_warning"]',c),fail:a('[data-mfa-template="overall_speed_fail"]',c),chart:a('[data-mfa-template="overall_speed_chart"]',c)},usability:{success:a('[data-mfa-template="overall_usability_success"]',c),warning:a('[data-mfa-template="overall_usability_warning"]',c),fail:a('[data-mfa-template="overall_usability_fail"]',c),chart:a('[data-mfa-template="overall_usability_chart"]',c)}},h=e.ruleGroups.SPEED.score;switch(!0){case h<b.fail_score:g.speed.success.addClass("hidden"),g.speed.warning.addClass("hidden"),g.speed.fail.removeClass("hidden"),f(h,g.speed.fail);break;case h<b.warning_score:g.speed.success.addClass("hidden"),g.speed.warning.removeClass("hidden"),g.speed.fail.addClass("hidden"),f(h,g.speed.warning);break;default:g.speed.success.removeClass("hidden"),g.speed.warning.addClass("hidden"),g.speed.fail.addClass("hidden"),f(h,g.speed.success)}var i=e.ruleGroups.USABILITY.score;switch(!0){case i<b.fail_score:g.usability.success.addClass("hidden"),g.usability.warning.addClass("hidden"),g.usability.fail.removeClass("hidden"),f(i,g.usability.fail);break;case i<b.warning_score:g.usability.success.addClass("hidden"),g.usability.warning.removeClass("hidden"),g.usability.fail.addClass("hidden"),f(i,g.usability.warning);break;default:g.usability.success.removeClass("hidden"),g.usability.warning.addClass("hidden"),g.usability.fail.addClass("hidden"),f(i,g.usability.success)}g.speed.chart.html(this.createGoogleOMeter(h)),g.usability.chart.html(this.createGoogleOMeter(i))}return this},b.createGoogleOMeter=function(b){var c=["chs=180x100","cht=gom","chd=t:"+b,"chxt=x,y","chxl=0:|"+b].join("&"),d=a("<img/>",{src:this.CHART_API_URL+c});return d.get(0)},b.createGooglePieChart=function(b,c,d,e){var f=["chs=300x140","cht=p3","chts="+["000000",16].join(","),"chco="+b.join("|"),"chd=t:"+c.join(","),"chdl="+d.join("|"),"chdls=000000,14","chp=1.6","chds=0,"+e].join("&"),g=a("<img/>",{src:this.CHART_API_URL+f});return g.get(0)},b.checkCache=function(a){var c=localStorage.getItem(this.CACHE_KEY);if(c){var d=null;try{d=JSON.parse(c)}catch(e){return b.log("Cache is corrupt: "+c),localStorage.removeItem(this.CACHE_KEY),!1}var f=d[a];if(f)return f}return!1},b.cacheResponse=function(a,c){if(this.cache_enabled){var d=localStorage.getItem(this.CACHE_KEY),e=null;if(d)try{e=JSON.parse(d)}catch(f){return b.log("Cache is corrupt: "+d),localStorage.removeItem(this.CACHE_KEY),!1}else e={};e[a]=c,localStorage.setItem(this.CACHE_KEY,JSON.stringify(e)),b.log("Cached audit response for: "+a)}return this},b.testLocalStorage=function(){var a="test";try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(b){return!1}},b.Init=function(c,d){try{if(this.Dom.Widget=a("#mobile_friendly_audit_widget"),this.Dom.Loader=a('[data-mfa-node="loader"]',this.Dom.Widget),this.Dom.Form=a('[data-mfa-node="form"]',this.Dom.Widget),this.Dom.Url=a('input[name="url"]',this.Dom.Form),this.Dom.ApiKey=a('input[name="api_key"]',this.Dom.Form),this.Dom.Error=a('[data-mfa-node="error"]',this.Dom.Form),this.Dom.Results=a('[data-mfa-node="results"]',this.Dom.Widget),0==this.Dom.Widget.length)throw"Widget node not found.";if(0==this.Dom.Loader.length)throw"Widget loader node not found.";if(0==this.Dom.Form.length)throw"Widget form node not found.";if(0==this.Dom.Url.length)throw"Widget url field not found.";if(0==this.Dom.ApiKey.length)throw"Widget api_key field not found.";if(0==this.Dom.Error.length)throw"Widget error message node not found.";if(0==this.Dom.Results.length)throw"Widget results node not found.";if(this.API_KEY=this.Dom.ApiKey.val(),0==this.API_KEY.length)throw"API KEY not set.";this.DEBUG="true"==this.Dom.Widget.attr("data-option-debug"),this.cache_enabled=this.cache_enabled&&this.testLocalStorage(),b.log("Cache "+(this.cache_enabled?"enabled":"disabled")),this.Dom.Form.on("submit",this.onFormSubmit),c&&c()}catch(e){d&&d(e)}},b.log=function(a){this.DEBUG&&console.log("object"==typeof a?a:"Mobile Friendly Audit: "+a)},a(document).ready(function(){b.Init(function(){b.log("Widget initialised successfully.")},function(a){b.log("Initialisation error: "+a)})})}(jQuery);